<script>
    // Populate dropdown from redirects.json
    async function populateRedirectKeys() {
        const selectElement = document.getElementById('redirectKey');
        try {
            const response = await fetch('redirects.json');
            const redirects = await response.json();

            // Populate dropdown
            selectElement.innerHTML = '<option value="" disabled selected>Select a redirect key</option>';
            Object.entries(redirects).forEach(([key, url]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${key} (${url})`;
                selectElement.appendChild(option);
            });
        } catch (error) {
            console.error('Failed to load redirect keys:', error);
            selectElement.innerHTML = '<option value="" disabled>Error loading options</option>';
        }
    }

    // Generate URL with the selected redirect key
    function generateUrl() {
        const baseUrl = window.location.origin;
        const redirectKey = document.getElementById('redirectKey').value;

        if (!redirectKey) {
            alert('Please select a redirect key');
            return;
        }

        // Collect all parameters
        const params = new URLSearchParams();
        params.append('redirect_key', redirectKey);

        // Add UTM and other tracking parameters
        const trackingParams = [
            'utmSource', 'utmMedium', 'utmCampaign', 'utmTerm', 'utmContent', 'gclid'
        ];

        trackingParams.forEach(param => {
            const element = document.getElementById(param);
            if (!element) {
                console.warn(`Element with id "${param}" not found.`);
                return;
            }
            const value = element.value.trim();
            if (value) {
                const queryParamName = param === 'utmSource' ? 'utm_source' :
                                       param === 'utmMedium' ? 'utm_medium' :
                                       param === 'utmCampaign' ? 'utm_campaign' :
                                       param === 'utmTerm' ? 'utm_term' :
                                       param === 'utmContent' ? 'utm_content' :
                                       param;
                params.append(queryParamName, value);
            }
        });

        // Generate full URL
        const fullUrl = `${baseUrl}?${params.toString()}`;

        // Display URL
        const generatedUrlEl = document.getElementById('generatedUrl');
        generatedUrlEl.textContent = fullUrl;

        // Show action buttons
        const actionButtons = document.getElementById('actionButtons');
        actionButtons.style.display = 'flex';

        // Update follow link
        const followLink = document.getElementById('followLink');
        followLink.href = fullUrl;
    }

    // Initialize dropdown on page load
    window.addEventListener('DOMContentLoaded', populateRedirectKeys);
</script>
